
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <link type="text/css" rel="stylesheet" href="style.css"/>
    <style type="text/css">
      svg {
        font-size: 16px;
      }

      rect {
        fill: #d24633;
        cursor: pointer; 
      }

      .axis {
        shape-rendering: crispEdges;
      }

      .axis path, .axis line {
        fill: none;
        stroke: #000;
        stroke-width: 1;
      }
    </style>
  </head>
  <body>
    <div id="statssvg1"></div>
    <script type="text/javascript" src="d3/d3.js"></script>
    <script type="text/javascript" src="d3/d3.layout.js"></script>
    <script type="text/javascript">

      var m = [0, 0, 0, 100], // top right bottom left
          w = 220, // width
          h = 320, // height
          x = d3.scale.linear().range([0, w]),
          y = 20;

      // var xAxis = d3.svg.axis()
      //     .scale(x)
      //     .orient("top");

      var svg = d3.select("#statssvg1").append("svg:svg")
          .attr("width", w + m[1] + m[3])
          .attr("height", h + m[0] + m[2])
        .append("svg:g")
          .attr("transform", "translate(" + m[3] + "," + m[0] + ")");

      svg.append("svg:g")
          .attr("class", "x axis");

      var userAnswers = {
        social: {
          familie: 9,
          vrienden: 8
        },
        religie: {
          waarde : 7
        }
      }

      function calculateUserDataFromAnswers( answers ) {
        var data = {answers: Array()};
        for (var subject in answers) {
          if (answers.hasOwnProperty(subject)) {
            var index = data.answers.push({}) - 1;
            var subjectAnswers = answers[subject];
            var i = 0;
            data.answers[index].size = 0;
            for (var key in subjectAnswers) {
              if (subjectAnswers.hasOwnProperty(key)) {
                data.answers[index].name = subject;
                data.answers[index].size+= subjectAnswers[key];
                i++;
              }
            }
            data.answers[index].size =  data.answers[index].size / i;
          }
        }
        console.log('user answers:', data);
        return data;
      }

      function calculateDutchDataFromAnswers( answers ) {
        var data = {answers: Array()};
        var totalAnswers = answers.total;
        var answers = answers.answers;
        for (var subject in answers) {
          if (answers.hasOwnProperty(subject)) {
            var index = data.answers.push({}) - 1;
            var subjectAnswers = answers[subject];
            var i = 0;
            data.answers[index].size = 0;
            for (var key in subjectAnswers) {
              if (subjectAnswers.hasOwnProperty(key)) {
                data.answers[index].name = subject;
                data.answers[index].size+= subjectAnswers[key];
                i++;
              }
            }
            data.answers[index].size =  data.answers[index].size / i;
            data.answers[index].size =  data.answers[index].size / totalAnswers;
          }
        }
        console.log('dutch answers:', data);
        return data;
      }

      d3.json("all_answers.json", function(data) {
        // var data = calculateDutchDataFromAnswers(data);
        var data = calculateUserDataFromAnswers(userAnswers);

        setDomain(data);
        setBar(data, 0);

        data.answers[2] = {}
        data.answers[2].name = "sport";
        data.answers[2].size = 10;

        // console.log(data);

        //console.log(data);

        updateBar(data, 0);
      });

      function setDomain(data) {
        var min = 0;
        var max = data.value;
        var max = 10;
        x.domain([min, max]).nice();
      }

      function openSubject(d) {
        console.log("open subject:", d.name);
      }

      function updateBar(d, i) {
        setBar(d);
      }

      // Creates a set of bars for the given data node, at the specified index.
      function setBar(d, i) {
        var bar = svg.insert("svg:g", ".y.axis")
            .attr("class", "enter")
            .attr("transform", "translate(0,0)")
          .selectAll("g")
            .data(d.answers)
          .enter().append("svg:g")
            .on("click", openSubject);

        bar.append("svg:text")
            .attr("x", -m[3])
            .attr("y", y / 2)
            .attr("dy", ".35em")
            .attr("text-anchor", "start")
            .text(function(d) { return d.name; });

        bar.append("svg:rect")
            .attr("width", function(d) { return x(d.size); })
            .attr("height", y);

        // Update the x-axis.
        // svg.selectAll(".x.axis")
        //     .call(xAxis);

        bar
          .attr("transform", function(d, i) { 
            var translateY = y * i * 1.8;
            return "translate(0," + translateY + ")";
          });       

        return bar;
      }






    </script>

  </body>
</html>
